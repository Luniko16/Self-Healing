<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>System Monitoring - Self-Healing Agent</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #0d1b2a 50%, #1b263b 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container { max-width: 1600px; margin: 0 auto; }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 24px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .tab:hover { background: rgba(255, 255, 255, 0.2); }
        .tab.active {
            background: rgba(255, 255, 255, 0.95);
            color: #1e3a8a;
            border-color: #2563eb;
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .metric-card h3 {
            color: #718096;
            font-size: 13px;
            text-transform: uppercase;
            margin-bottom: 15px;
        }
        
        .metric-value {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1e3a8a 0%, #2563eb 100%);
            transition: width 0.3s;
        }
        
        .progress-fill.warning { background: linear-gradient(90deg, #ed8936 0%, #dd6b20 100%); }
        .progress-fill.danger { background: linear-gradient(90deg, #f56565 0%, #e53e3e 100%); }
        
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f7fafc;
            color: #2d3748;
            font-weight: 600;
        }
        
        td { color: #4a5568; }
        
        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-success { background: #48bb78; color: white; }
        .badge-warning { background: #ed8936; color: white; }
        .badge-danger { background: #f56565; color: white; }
        
        .refresh-btn {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .refresh-btn:hover { transform: translateY(-2px); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>&#128202; System Monitoring & Management</h1>
            <button class="refresh-btn" onclick="refreshAll()">&#128260; Refresh All</button>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('metrics')">&#128200; Metrics</div>
            <div class="tab" onclick="showTab('software')">&#128230; Software</div>
            <div class="tab" onclick="showTab('events')">&#128221; Events</div>
            <div class="tab" onclick="showTab('security')">&#128274; Security</div>
        </div>
        
        <!-- Metrics Tab -->
        <div id="metrics" class="tab-content active">
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>CPU Usage</h3>
                    <div class="metric-value" id="cpu-percent">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cpu-bar" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <h3>Memory Usage</h3>
                    <div class="metric-value" id="mem-percent">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mem-bar" style="width: 0%"></div>
                    </div>
                    <p style="margin-top: 10px; color: #718096; font-size: 14px;" id="mem-details"></p>
                </div>
                
                <div class="metric-card">
                    <h3>Disk Usage</h3>
                    <div class="metric-value" id="disk-percent">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="disk-bar" style="width: 0%"></div>
                    </div>
                    <p style="margin-top: 10px; color: #718096; font-size: 14px;" id="disk-details"></p>
                </div>
                
                <div class="metric-card">
                    <h3>System Uptime</h3>
                    <div class="metric-value" id="uptime-days">0d</div>
                    <p style="margin-top: 10px; color: #718096; font-size: 14px;" id="uptime-details"></p>
                </div>
            </div>
            
            <div class="table-container">
                <h3 style="margin-bottom: 15px; color: #2d3748;">Top Processes</h3>
                <table id="processes-table">
                    <thead>
                        <tr>
                            <th>Process</th>
                            <th>PID</th>
                            <th>CPU %</th>
                            <th>Memory %</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="processes-body"></tbody>
                </table>
            </div>
        </div>
        
        <!-- Software Tab -->
        <div id="software" class="tab-content">
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>Total Installed</h3>
                    <div class="metric-value" id="software-total">0</div>
                </div>
                
                <div class="metric-card">
                    <h3>Outdated Software</h3>
                    <div class="metric-value" id="software-outdated">0</div>
                </div>
            </div>
            
            <div class="table-container">
                <h3 style="margin-bottom: 15px; color: #2d3748;">Installed Software</h3>
                <table id="software-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Version</th>
                            <th>Publisher</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="software-body"></tbody>
                </table>
            </div>
        </div>
        
        <!-- Events Tab -->
        <div id="events" class="tab-content">
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>Total Events (24h)</h3>
                    <div class="metric-value" id="events-total">0</div>
                </div>
                
                <div class="metric-card">
                    <h3>Recurring Issues</h3>
                    <div class="metric-value" id="events-recurring">0</div>
                </div>
            </div>
            
            <div class="table-container">
                <h3 style="margin-bottom: 15px; color: #2d3748;">Critical Events</h3>
                <table id="events-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Level</th>
                            <th>Source</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody id="events-body"></tbody>
                </table>
            </div>
        </div>
        
        <!-- Security Tab -->
        <div id="security" class="tab-content">
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>Compliance Score</h3>
                    <div class="metric-value" id="compliance-score">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="compliance-bar" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <h3>Critical Issues</h3>
                    <div class="metric-value" id="critical-issues">0</div>
                </div>
            </div>
            
            <div class="table-container">
                <h3 style="margin-bottom: 15px; color: #2d3748;">Security Checks</h3>
                <table id="security-table">
                    <thead>
                        <tr>
                            <th>Check</th>
                            <th>Status</th>
                            <th>Severity</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="security-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Load data for the tab
            if (tabName === 'metrics') loadMetrics();
            else if (tabName === 'software') loadSoftware();
            else if (tabName === 'events') loadEvents();
            else if (tabName === 'security') loadSecurity();
        }
        
        function loadMetrics() {
            fetch('/api/system/metrics')
                .then(r => r.json())
                .then(data => {
                    // CPU
                    document.getElementById('cpu-percent').textContent = data.cpu.percent + '%';
                    document.getElementById('cpu-bar').style.width = data.cpu.percent + '%';
                    document.getElementById('cpu-bar').className = 'progress-fill ' + 
                        (data.cpu.percent > 80 ? 'danger' : data.cpu.percent > 60 ? 'warning' : '');
                    
                    // Memory
                    document.getElementById('mem-percent').textContent = data.memory.percent.toFixed(1) + '%';
                    document.getElementById('mem-bar').style.width = data.memory.percent + '%';
                    document.getElementById('mem-bar').className = 'progress-fill ' + 
                        (data.memory.percent > 80 ? 'danger' : data.memory.percent > 60 ? 'warning' : '');
                    document.getElementById('mem-details').textContent = 
                        `${data.memory.used_gb} GB / ${data.memory.total_gb} GB`;
                    
                    // Disk
                    if (data.disks.length > 0) {
                        const disk = data.disks[0];
                        document.getElementById('disk-percent').textContent = disk.percent.toFixed(1) + '%';
                        document.getElementById('disk-bar').style.width = disk.percent + '%';
                        document.getElementById('disk-bar').className = 'progress-fill ' + 
                            (disk.percent > 80 ? 'danger' : disk.percent > 60 ? 'warning' : '');
                        document.getElementById('disk-details').textContent = 
                            `${disk.free_gb} GB free of ${disk.total_gb} GB`;
                    }
                    
                    // Uptime
                    document.getElementById('uptime-days').textContent = data.boot.uptime_days + 'd';
                    document.getElementById('uptime-details').textContent = 
                        `${data.boot.uptime_hours}h ${data.boot.uptime_minutes}m`;
                    
                    // Processes
                    const tbody = document.getElementById('processes-body');
                    tbody.innerHTML = '';
                    data.processes.slice(0, 10).forEach(proc => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${proc.name}</td>
                                <td>${proc.pid}</td>
                                <td>${proc.cpu_percent.toFixed(1)}%</td>
                                <td>${proc.memory_percent.toFixed(1)}%</td>
                                <td><span class="badge badge-success">${proc.status}</span></td>
                            </tr>
                        `;
                    });
                });
        }
        
        function loadSoftware() {
            fetch('/api/software/inventory')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('software-total').textContent = data.total_installed;
                    document.getElementById('software-outdated').textContent = data.outdated_count;
                    
                    const tbody = document.getElementById('software-body');
                    tbody.innerHTML = '';
                    data.software.forEach(sw => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${sw.name || 'Unknown'}</td>
                                <td>${sw.version || 'N/A'}</td>
                                <td>${sw.publisher || 'Unknown'}</td>
                                <td><span class="badge badge-success">Installed</span></td>
                            </tr>
                        `;
                    });
                });
        }
        
        function loadEvents() {
            fetch('/api/events/critical')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('events-total').textContent = data.analysis.total_events;
                    document.getElementById('events-recurring').textContent = data.analysis.recurring_issues.length;
                    
                    const tbody = document.getElementById('events-body');
                    tbody.innerHTML = '';
                    data.events.forEach(evt => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${new Date(evt.timestamp).toLocaleString()}</td>
                                <td><span class="badge badge-danger">${evt.level}</span></td>
                                <td>${evt.source}</td>
                                <td>${evt.message}</td>
                            </tr>
                        `;
                    });
                });
        }
        
        function loadSecurity() {
            fetch('/api/security/compliance')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('compliance-score').textContent = data.compliance_score + '%';
                    document.getElementById('compliance-bar').style.width = data.compliance_score + '%';
                    document.getElementById('compliance-bar').className = 'progress-fill ' + 
                        (data.compliance_score < 60 ? 'danger' : data.compliance_score < 80 ? 'warning' : '');
                    document.getElementById('critical-issues').textContent = data.critical_issues.length;
                    
                    const tbody = document.getElementById('security-body');
                    tbody.innerHTML = '';
                    Object.entries(data.checks).forEach(([name, check]) => {
                        const statusBadge = check.status === 'compliant' ? 'badge-success' : 
                                          check.status === 'non_compliant' ? 'badge-danger' : 'badge-warning';
                        const severityBadge = check.severity === 'critical' ? 'badge-danger' :
                                            check.severity === 'high' ? 'badge-warning' : 'badge-success';
                        
                        tbody.innerHTML += `
                            <tr>
                                <td>${name.replace(/_/g, ' ').toUpperCase()}</td>
                                <td><span class="badge ${statusBadge}">${check.status}</span></td>
                                <td><span class="badge ${severityBadge}">${check.severity || 'N/A'}</span></td>
                                <td>${check.message || 'OK'}</td>
                            </tr>
                        `;
                    });
                });
        }
        
        function refreshAll() {
            const activeTab = document.querySelector('.tab.active').textContent.toLowerCase();
            if (activeTab.includes('metrics')) loadMetrics();
            else if (activeTab.includes('software')) loadSoftware();
            else if (activeTab.includes('events')) loadEvents();
            else if (activeTab.includes('security')) loadSecurity();
        }
        
        // Auto-refresh every 30 seconds
        setInterval(refreshAll, 30000);
        
        // Initial load
        loadMetrics();
    </script>
</body>
</html>
