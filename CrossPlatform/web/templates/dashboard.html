<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Healing Agent Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; margin: 0; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; }
        .header h1 { color: #667eea; margin: 0; }
        .controls { background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; }
        .btn { padding: 12px 24px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; margin-right: 10px; }
        .btn-primary { background: #667eea; color: white; }
        .status-bar { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px; }
        .summary-card { background: white; padding: 25px; border-radius: 10px; }
        .summary-card .value { font-size: 36px; font-weight: bold; color: #667eea; }
        .results { background: white; padding: 25px; border-radius: 10px; }
        .module-card { border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 15px; }
        .issue-item { padding: 12px; background: #f7fafc; border-left: 4px solid #ed8936; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        .btn-success { background: #48bb78; color: white; }
        .btn-warning { background: #ed8936; color: white; }
        .hidden { display: none; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛠️ Self-Healing Agent Dashboard</h1>
            <p>Platform: {{ platform }} | Admin: {{ is_admin }}</p>
        </div>
        <div class="controls">
            <h2>Control Panel</h2>
            <button class="btn btn-primary" onclick="startScan(['network', 'disk', 'service', 'printer'])">🔍 Run Full Scan</button>
            <button class="btn btn-primary" onclick="startScan(['network'])">🌐 Network</button>
            <button class="btn btn-primary" onclick="startScan(['disk'])">💾 Disk</button>
            <button class="btn btn-primary" onclick="startScan(['service'])">⚙️ Services</button>
            <button class="btn btn-primary" onclick="startScan(['printer'])">🖨️ Printer</button>
        </div>
        <div class="status-bar">
            <h3>Status</h3>
            <div id="status">Ready to scan</div>
        </div>
        <div id="summary" class="summary hidden">
            <div class="summary-card"><h3>Modules</h3><div class="value" id="total-modules">0</div></div>
            <div class="summary-card"><h3>Issues</h3><div class="value" id="issues-found">0</div></div>
            <div class="summary-card"><h3>Healthy</h3><div class="value" id="no-issues">0</div></div>
            <div class="summary-card"><h3>Errors</h3><div class="value" id="errors">0</div></div>
        </div>
        <div id="results" class="results hidden">
            <h2>Results</h2>
            <div id="results-content"></div>
        </div>
    </div>
    <script>
        let scanInterval = null;
        function startScan(modules) {
            document.getElementById('status').innerHTML = '<span class="spinner"></span>Scanning...';
            document.getElementById('summary').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
            fetch('/api/scan', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ modules: modules }) })
            .then(response => response.json())
            .then(data => { scanInterval = setInterval(checkResults, 2000); });
        }
        function checkResults() {
            fetch('/api/status').then(response => response.json()).then(data => {
                if (!data.scan_in_progress && data.has_results) { clearInterval(scanInterval); loadResults(); }
            });
        }
        function loadResults() {
            fetch('/api/results').then(response => response.json()).then(data => displayResults(data));
        }
        function displayResults(data) {
            document.getElementById('status').textContent = 'Completed: ' + new Date(data.timestamp).toLocaleString();
            document.getElementById('total-modules').textContent = data.summary.total_modules;
            document.getElementById('issues-found').textContent = data.summary.issues_found;
            document.getElementById('no-issues').textContent = data.summary.no_issues;
            document.getElementById('errors').textContent = data.summary.errors;
            document.getElementById('summary').classList.remove('hidden');
            let html = '';
            data.results.forEach((result) => {
                const issues = result.detection?.issues || [];
                html += '<div class="module-card"><h3>' + result.module + ' - ' + result.status + '</h3>';
                if (issues.length > 0) {
                    issues.forEach((issue, idx) => {
                        html += '<div class="issue-item"><span>' + issue + '</span><div>';
                        html += '<button class="btn btn-success btn-small" onclick="fixIssue(\'' + result.module + '\',' + idx + ')">Fix</button>';
                        html += '<button class="btn btn-warning btn-small" onclick="escalate(\'' + result.module + '\',\'' + issue + '\')">Escalate</button>';
                        html += '</div></div>';
                    });
                }
                html += '</div>';
            });
            document.getElementById('results-content').innerHTML = html;
            document.getElementById('results').classList.remove('hidden');
        }
        function fixIssue(module, idx) {
            if (confirm('Fix this issue?')) {
                fetch('/api/fix/' + module + '/' + idx, { method: 'POST' })
                .then(response => response.json())
                .then(data => { alert(data.message); setTimeout(() => startScan([module]), 3000); });
            }
        }
        function escalate(module, issue) {
            const notes = prompt('Notes for Tier 2:');
            if (notes) {
                fetch('/api/escalate', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ module: module, issue: issue, notes: notes }) })
                .then(response => response.json())
                .then(data => alert(data.message));
            }
        }
    </script>
</body>
</html>
<!-- Reload: 20260115101333 -->
