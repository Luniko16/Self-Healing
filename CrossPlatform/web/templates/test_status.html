<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f0f0; }
        .box { background: white; padding: 20px; margin: 10px 0; border-radius: 5px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Public Status API Test</h1>
    
    <div class="box">
        <h2>Test 1: Fetch API</h2>
        <div id="test1">Testing...</div>
    </div>
    
    <div class="box">
        <h2>Test 2: API Response</h2>
        <pre id="test2">Loading...</pre>
    </div>
    
    <div class="box">
        <h2>Test 3: Services Data</h2>
        <div id="test3">Loading...</div>
    </div>

    <script>
        // Test 1: Check if fetch works
        try {
            document.getElementById('test1').innerHTML = '<span class="success">✓ Fetch API available</span>';
        } catch(e) {
            document.getElementById('test1').innerHTML = '<span class="error">✗ Fetch API error: ' + e.message + '</span>';
        }
        
        // Test 2: Fetch the API
        fetch('/api/public/status')
            .then(response => {
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('test2').textContent = JSON.stringify(data, null, 2);
                
                // Test 3: Display services
                if (data.services && data.services.length > 0) {
                    let html = '<span class="success">✓ Found ' + data.services.length + ' services:</span><ul>';
                    data.services.forEach(s => {
                        html += '<li>' + s.name + ' - ' + (s.operational ? 'OK' : 'ISSUE') + '</li>';
                    });
                    html += '</ul>';
                    document.getElementById('test3').innerHTML = html;
                } else {
                    document.getElementById('test3').innerHTML = '<span class="error">✗ No services found</span>';
                }
            })
            .catch(error => {
                document.getElementById('test2').textContent = 'ERROR: ' + error.message;
                document.getElementById('test3').innerHTML = '<span class="error">✗ Failed to load: ' + error.message + '</span>';
            });
    </script>
</body>
</html>
